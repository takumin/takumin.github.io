<!doctype html><html lang=ja><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Takumi Takahashi"><meta name=description content="Takumi Takahashi Personal Website"><meta name=keywords content="blog,developer,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="(第7回WSA研) マルチクラウド対応の認可アーキテクチャ"><meta name=twitter:description content="製造業におけるIoTシステム開発など、特殊なシステムアーキテクチャが必要とされる場合において、DevSecOpsを前提とした認証・認可アーキテクチャのあり方を模索してみました"><meta property="og:title" content="(第7回WSA研) マルチクラウド対応の認可アーキテクチャ"><meta property="og:description" content="製造業におけるIoTシステム開発など、特殊なシステムアーキテクチャが必要とされる場合において、DevSecOpsを前提とした認証・認可アーキテクチャのあり方を模索してみました"><meta property="og:type" content="article"><meta property="og:url" content="https://takumi.tmfam.com/posts/authnz-architecture/"><meta property="article:published_time" content="2020-11-06T00:00:00+00:00"><meta property="article:modified_time" content="2020-11-06T23:51:01+09:00"><base href=https://takumi.tmfam.com/posts/authnz-architecture/><title>(第7回WSA研) マルチクラウド対応の認可アーキテクチャ · Takumin Notes</title><link rel=canonical href=https://takumi.tmfam.com/posts/authnz-architecture/><link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700&display=swap" rel=stylesheet><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.11.2/css/all.css integrity=sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin=anonymous><link rel=stylesheet href=https://takumi.tmfam.com/css/coder.min.a4f332213a21ce8eb521670c614470c58923aaaf385e2a73982c31dd7642decb.css integrity="sha256-pPMyITohzo61IWcMYURwxYkjqq84XipzmCwx3XZC3ss=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=https://takumi.tmfam.com/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://takumi.tmfam.com/images/favicon-16x16.png sizes=16x16><meta name=generator content="Hugo 0.78.1"></head><body class=colorscheme-light><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=https://takumi.tmfam.com/>Takumin Notes</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fas fa-bars"></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=https://takumi.tmfam.com/about/>About</a></li><li class=navigation-item><a class=navigation-link href=https://takumi.tmfam.com/pages/>Pages</a></li><li class=navigation-item><a class=navigation-link href=https://takumi.tmfam.com/posts/>Blog</a></li><li class=navigation-item><a class=navigation-link href=https://takumi.tmfam.com/categories/>Category</a></li><li class=navigation-item><a class=navigation-link href=https://takumi.tmfam.com/tags/>Tags</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title>(第7回WSA研) マルチクラウド対応の認可アーキテクチャ</h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fas fa-calendar"></i><time datetime=2020-11-06T00:00:00Z>November 6, 2020</time></span>
<span class=reading-time><i class="fas fa-clock"></i>5分で読めます</span></div><div class=categories><i class="fas fa-folder"></i><a href=https://takumi.tmfam.com/categories/authentication/>Authentication</a>
<span class=separator>•</span>
<a href=https://takumi.tmfam.com/categories/authorization/>Authorization</a>
<span class=separator>•</span>
<a href=https://takumi.tmfam.com/categories/openid-connect/>OpenID Connect</a></div><div class=tags><i class="fas fa-tag"></i><a href=https://takumi.tmfam.com/tags/authentication/>Authentication</a>
<span class=separator>•</span>
<a href=https://takumi.tmfam.com/tags/authorization/>Authorization</a>
<span class=separator>•</span>
<a href=https://takumi.tmfam.com/tags/openid-connect/>OpenID Connect</a>
<span class=separator>•</span>
<a href=https://takumi.tmfam.com/tags/keycloak/>Keycloak</a>
<span class=separator>•</span>
<a href=https://takumi.tmfam.com/tags/api-gateway/>API Gateway</a>
<span class=separator>•</span>
<a href=https://takumi.tmfam.com/tags/kong/>Kong</a></div></div></header><div><h1 id=---fit----第7回wsa研-マルチクラウド対応の認可アーキテクチャ>(第7回WSA研) マルチクラウド対応の認可アーキテクチャ</h1><p>2020/11/07 Takumi Takahashi</p><h2 id=はじめに>はじめに</h2><p>製造業におけるIoTシステム開発など、特殊なシステムアーキテクチャが必要とされる場合において、DevSecOpsを前提とした認証・認可アーキテクチャのあり方を模索してみました。</p><h2 id=謝辞とお詫び>謝辞とお詫び</h2><ul><li>このような場に迎え入れてくださり、ありがとうございました 🙏</li><li>本発表に先立ち、様々な資料や文献、製品等の調査を進める過程で
自身の知識不足であることが明確になりました</li><li>また、既存製品・研究・規格の調査で時間切れとなってしまい
着想を具現化するに至りませんでした</li><li>このようなレベルの高い場に出席させていただきながら
個人のメモ書きレベルになってしまったこと、深くお詫びします</li></ul><h2 id=背景>背景</h2><ul><li>一般的な製造業は物理世界との結びつきが強いという特性上
製造業に特化した技術が数多くありますが、昨今IoTなどの
キーワードを旗印に、徐々にですがWebに由来する技術が
取り入れられつつあります</li><li>ですが、近年サイバーセキュリティに関する関連法規の具体化
など、素人がWebシステム開発するには、非常に厳しい世界に
なっている現実もあります</li><li>以上の背景から、元組み込みエンジニアの観点を取り入れ、
素人でも安心してソフトウェア開発できる、汎用的な認証認可の
仕組みを考案してみました</li></ul><h2 id=認証と認可について>認証と認可について</h2><ul><li>認証とは<ul><li>「通信相手が誰（何）であるか」を確認すること</li></ul></li><li>認可とは<ul><li>「対象となるリソースへのアクセス制御」を行うこと</li></ul></li><li>本資料では認可に着目し、汎用的な認証認可の仕組みを考案します</li></ul><h2 id=対象となるソフトウェアシステム>対象となるソフトウェアシステム</h2><ul><li>REST APIサーバー<ul><li>OpenAPI等、スキーマ定義が外部化でき、また枯れた実装も多く、初心者でも始めやすい環境が整っていると考えています</li></ul></li></ul><h2 id=関連するソフトウェアシステム>関連するソフトウェアシステム</h2><ul><li>API Gateway<ul><li>上述したOpenAPI等のスキーマ定義を用いて、リソース(API)のルーティング、スループット制限等、システムとは直接関係のないリソース管理を行います</li></ul></li><li>OpenID Connect IdP (OP)<ul><li>一般的な企業ではLDAPやActive Directory等、既存ディレクトリサービスが導入されているケースが多く、また従業員情報や機器情報は一種の資産であり、これらの情報を認可情報源として活用することで、システム開発者とシステム運用者の権限分離を図ります</li></ul></li></ul><h2 id=認可方式>認可方式</h2><ul><li>前述した各種情報資産を利活用でき、また将来に対しての拡張性を考慮した上で、ABAC ( Attribute Based Access Control ) の方式とします</li><li>例えば従業員情報として、ID, パスワード, メールアドレス, 所属情報等の情報が予め入力されている事が多く、これらの情報をシステムごとに投入せずに活用できることで、設計・開発工数を削減します</li></ul><h2 id=既存製品規格>既存製品・規格</h2><ul><li>既存実装としてはパブリッククラウドではAWS, GCP, Azure等、各社製品をリリースされています</li><li>国内ではAuthlete社が、FAPI(Financial API)グレードの認証認可に特化した製品をリリースされています</li><li>いずれの製品で共通している機能として、OpenID Connectを用いた認証認可の仕組みを提供されています</li></ul><h2 id=openid-connect-について>OpenID Connect について</h2><ul><li>OpenID Connectの出自はOAuth 2.0が起源で、SAML 2.0等の既存認証認可の仕組みを取り入れた規格となっています</li><li>OAuth 2.0やSAML 2.0、OpenID Connect等の規格そのものはとても巨大であり、またWeb上に各種資料がありますので、本資料では規格そのものについては具体的に言及しませんが、本資料のスコープであるABACによる認可を行うにあたり、OpenID Connect Core SpecであるUserInfo Request/Responseにフォーカスをあてます</li></ul><h2 id=これまでのまとめ>これまでのまとめ</h2><ul><li>REST APIサーバーを対象としたAPI Gateway, OpenID Connect IdPを用意することで、REST APIサーバー実装担当はCRUD実装に注力することが可能になる</li><li>同時にREST APIサーバー等Webシステム開発の経験が浅い開発者でも、コンテナ等の技術を活用することで、OJT形式で技術のキャッチアップが可能になる</li><li>またAPI Gateway, OpenID Connect IdPを採用することで、中央集約的にセキュリティ対策やコンプライアンス、ガバナンスが可能になる</li></ul><h2 id=検討したミニマムアーキテクチャ>検討したミニマムアーキテクチャ</h2><p><img src=imgs/architecture.png alt="bg 60%"></p><h2 id=api-gateway-kong-について>API Gateway (Kong) について</h2><ul><li>API Gatewayとしての採用実績が多く、またコアとなるはNGINXであるため、<a href=https://github.com/matsumotory/ngx_mruby>matsumotory/ngx_mruby</a>など、ダイナミックなABACが可能になる</li><li>また、Lua言語による拡張方式や、Go言語による拡張方式、あるいはRust等によるFFIも考慮に入るため、ABACの難しさを考慮した上で採用</li></ul><h2 id=openid-connect-idp-keycloak-について>OpenID Connect IdP (Keycloak) について</h2><ul><li><p>既に金融業界での導入実績等があり、またOCIコンテナを用いると、容易にHAクラスタ展開が可能であることなどから採用</p></li><li><p>日立製作所 OSSソリューションセンタ 中村 雄一様
オープンAPIに求められる認可認証OSSセキュリティ技術</p><ul><li><a href=https://www.iwsec.org/ows/2019/Materials/CSS2019_Nakamura.pdf>https://www.iwsec.org/ows/2019/Materials/CSS2019_Nakamura.pdf</a></li></ul></li></ul><h2 id=今後について>今後について</h2><ul><li>本資料では事前調査と構成検討だけで終始してしまったため、今後はABAC認可の実現を目指します</li></ul><h2 id=最後に>最後に</h2><p>本記事に書かれている内容は個人的な見解であり、私が所属する組織の見解は含まれず、所属組織とは一切関係ありません</p></div><footer></footer></article><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script type=text/javascript async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js id=MathJax-script></script><script>MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']],processEscapes:true,processEnvironments:true},options:{skipHtmlTags:['script','noscript','style','textarea','pre']}};</script></section></div><footer class=footer><section class=container></section></footer></main><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-62539992-1','auto');ga('send','pageview');}</script></body></html>